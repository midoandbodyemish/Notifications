<!DOCTYPE html><html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุดุนุงุฑุงุช Firebase</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-messaging.js";
        import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";const firebaseConfig = {
        apiKey: "AIzaSyAJzK9G2MJieXHmeeHUBdULdDt8NwyxyKQ",
        authDomain: "khedma-fd534.firebaseapp.com",
        projectId: "khedma-fd534",
        storageBucket: "khedma-fd534.firebasestorage.app",
        messagingSenderId: "186556101962",
        appId: "1:186556101962:web:de1945009a23d99cf83db3",
        measurementId: "G-JNTZRQ2W4S"
    };

    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);
    const database = getDatabase(app);

    function updateSubscribersCount() {
        get(ref(database, "tokens")).then((snapshot) => {
            const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
            document.getElementById("subscribersCount").innerText = `ุนุฏุฏ ุงููุดุชุฑููู: ${count}`;
        });
    }

    document.getElementById("subscribeBtn").addEventListener("click", () => {
        Notification.requestPermission().then((permission) => {
            if (permission === "granted") {
                getToken(messaging, { vapidKey: "BIzL5Lxxxxxxxxxx" })
                    .then((token) => {
                        if (token) {
                            set(ref(database, "tokens/" + token), { subscribed: true }).then(() => {
                                console.log("โ ุชู ุงูุงุดุชุฑุงู ูู ุงูุฅุดุนุงุฑุงุช.");
                                updateSubscribersCount();
                            });
                        }
                    })
                    .catch((err) => console.log("โ ุฎุทุฃ ูู ุงูุญุตูู ุนูู Token:", err));
            }
        });
    });

    document.getElementById("unsubscribeBtn").addEventListener("click", () => {
        getToken(messaging).then((token) => {
            remove(ref(database, "tokens/" + token)).then(() => {
                console.log("๐๏ธ ุชู ุฅูุบุงุก ุงูุงุดุชุฑุงู.");
                updateSubscribersCount();
            });
        });
    });

    onMessage(messaging, (payload) => {
        console.log("๐ฉ ุฑุณุงูุฉ ูุงุฑุฏุฉ: ", payload);
        alert(payload.notification.title + "\n" + payload.notification.body);
    });

    updateSubscribersCount();
</script>

</head>
<body>
    <h3 id="subscribersCount">ุนุฏุฏ ุงููุดุชุฑููู: 0</h3>
    <button id="subscribeBtn">๐ ุงุดุชุฑุงู ูู ุงูุฅุดุนุงุฑุงุช</button>
    <button id="unsubscribeBtn">๐ซ ุฅูุบุงุก ุงูุงุดุชุฑุงู</button>
</body>
</html>